FROM node:20-alpine

# Install FFmpeg and bash (useful in dev)
RUN apk add --no-cache ffmpeg bash

WORKDIR /app

# Copy only package files first (cache layer for deps)
COPY package*.json ./

# Install deps
RUN npm install

# Copy project files (excluding node_modules via .dockerignore)
COPY . .

# Ensure uploads dir exists
RUN mkdir -p uploads

EXPOSE 3000

# Run in dev mode with hot reload
CMD ["npm", "run", "start:dev"]
